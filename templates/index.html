<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cell Totals Submission</title>
    <link
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        background: linear-gradient(to right, #f8f9fa, #e9ecef);
      }
      .navbar {
        background: linear-gradient(to right, #007bff, #6610f2);
      }
      .sidebar {
        background: linear-gradient(to bottom, #343a40, #212529);
        height: 100vh;
        padding-top: 20px;
      }
      .sidebar a {
        color: white;
        display: block;
        padding: 10px;
        text-decoration: none;
      }
      .sidebar a:hover {
        background-color: #495057;
      }
      .main-content {
        margin-left: 200px;
        padding: 20px;
      }
      .form-control {
        margin-bottom: 10px;
      }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark">
      <a class="navbar-brand" href="#">Breakthrough.int</a>
      <div class="collapse navbar-collapse">
        <ul class="navbar-nav mr-auto">
          <li class="nav-item"><a class="nav-link" href="#">HOME</a></li>
          <li class="nav-item"><a class="nav-link" href="#">SUBMIT</a></li>
          <li class="nav-item"><a class="nav-link" href="#">LOG OUT</a></li>
        </ul>
        <button class="btn btn-outline-light my-2 my-sm-0" type="button">
          Help?
        </button>
      </div>
    </nav>
    <div class="d-flex">
      <div class="sidebar">
        <a href="#">Branch Totals</a>
        <a href="#">Zone Totals</a>
        <a href="#">Cell Leaders Profile</a>
        <a href="#">Dashboard</a>
        <a href="#">Church Attendance</a>
      </div>
      <div class="main-content">
        <h2>Cell Totals Submission</h2>
        <form action="/submit" method="post">
          <select
            name="zone"
            class="form-control"
            onchange="updateLeaders()"
            required
          >
            <option value="">Select Zone</option>
            <option value="Korle Bu">Korle Bu</option>
            <option value="Extension">Extension</option>
          </select>

          <label for="service_day">Service Day:</label>
          <select
            id="service_day"
            name="service_day"
            class="form-control"
            required
          >
            <option value="Thursday">Thursday</option>
            <option value="Sunday">Sunday</option>
          </select>

          <label for="leader_name">Leader Name:</label>
          <select
            id="leader_name"
            name="leader_name"
            class="form-control"
            required
          >
            <option value="">Select Leader</option>
          </select>

          <label for="grand_total">Grand Total:</label>
          <input
            type="number"
            id="grand_total"
            name="grand_total"
            class="form-control"
            required
          />

          <label for="visitors">Visitors:</label>
          <input
            type="number"
            id="visitors"
            name="visitors"
            class="form-control"
            required
          />

          <label for="decisions">Decisions:</label>
          <input
            type="number"
            id="decisions"
            name="decisions"
            class="form-control"
            required
          />

          <label for="offering">Offering (R):</label>
          <input
            type="number"
            step="0.01"
            id="offering"
            name="offering"
            class="form-control"
            required
          />

          <label for="submission_date">Submission Date:</label>
          <input
            type="date"
            id="submission_date"
            name="submission_date"
            class="form-control"
            required
          /><br />

          <button type="submit" class="btn btn-primary">Submit Totals</button>
        </form>

        <h2>Submitted Totals</h2>
        <table class="table table-bordered">
          <thead>
            <tr>
              <th>ID</th>
              <th>Zone</th>
              <th>Grand Total</th>
              <th>Visitors</th>
              <th>Decisions</th>
              <th>Offering</th>
              <th>Submission Date</th>
              <th>Leader Name</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for total in totals %}
            <tr>
              <td>{{ total.ID }}</td>
              <td>{{ total.Zone }}</td>
              <td>{{ total.GrandTotal }}</td>
              <td>{{ total.Visitors }}</td>
              <td>{{ total.Decisions }}</td>
              <td>{{ total.Offering }}</td>
              <td>{{ total.SubmissionDate }}</td>
              <td>{{ total.LeaderName }}</td>
              <td>
                <button
                  class="btn btn-warning"
                  onclick="editEntry('{{ total.ID }}', '{{ total.Zone }}', '{{ total.GrandTotal }}', '{{ total.Visitors }}', '{{ total.Decisions }}', '{{ total.Offering }}', '{{ total.SubmissionDate }}', '{{ total.LeaderName }}')"
                >
                  Edit
                </button>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>

        <div id="edit_form" style="display: none">
          <h2>Edit Totals</h2>
          <form action="/update" method="post">
            <input type="hidden" id="edit_id" name="id" />
            <label for="edit_zone">Zone:</label>
            <input
              type="text"
              id="edit_zone"
              name="zone"
              class="form-control"
              readonly
            /><br />
            <label for="edit_grand_total">Grand Total:</label>
            <input
              type="number"
              id="edit_grand_total"
              name="grand_total"
              class="form-control"
              required
            /><br />
            <label for="edit_visitors">Visitors:</label>
            <input
              type="number"
              id="edit_visitors"
              name="visitors"
              class="form-control"
              required
            /><br />
            <label for="edit_decisions">Decisions:</label>
            <input
              type="number"
              id="edit_decisions"
              name="decisions"
              class="form-control"
              required
            /><br />
            <label for="edit_offering">Offering (in Rands):</label>
            <input
              type="number"
              step="0.01"
              id="edit_offering"
              name="offering"
              class="form-control"
              required
            /><br />
            <label for="edit_submission_date">Submission Date:</label>
            <input
              type="date"
              id="edit_submission_date"
              name="submission_date"
              class="form-control"
              required
            /><br />

            <label for="edit_leader_name">Leader Name:</label>
            <input
              type="text"
              id="edit_leader_name"
              name="leader_name"
              class="form-control"
              readonly
            /><br />
            <button type="submit" class="btn btn-primary">Update</button>
          </form>
        </div>
      </div>
    </div>
    <script>
      function updateLeaders() {
        const zone = document.querySelector('select[name="zone"]').value;
        const leaderDropdown = document.getElementById("leader_name");
        leaderDropdown.innerHTML = '<option value="">Select Leader</option>';

        if (zone) {
          fetch(`/get_leaders/${zone}`)
            .then((response) => response.json())
            .then((leaders) => {
              leaders.forEach((leader) => {
                const option = document.createElement("option");
                option.value = leader;
                option.textContent = leader;
                leaderDropdown.appendChild(option);
              });
            });
        }
      }

      function editEntry(
        id,
        zone,
        grandTotal,
        visitors,
        decisions,
        offering,
        submissionDate,
        leaderName
      ) {
        document.getElementById("edit_id").value = id;
        document.getElementById("edit_zone").value = zone;
        document.getElementById("edit_grand_total").value = grandTotal;
        document.getElementById("edit_visitors").value = visitors;
        document.getElementById("edit_decisions").value = decisions;
        document.getElementById("edit_offering").value = offering;
        document.getElementById("edit_submission_date").value = submissionDate;
        document.getElementById("edit_leader_name").value = leaderName;
        document.getElementById("edit_form").style.display = "block";
      }
    </script>
  </body>
</html>
